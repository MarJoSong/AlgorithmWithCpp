//
// Created by Mars on 2021/6/23.
//

#ifndef INC_1_SORT__HEAP_HPP_
#define INC_1_SORT__HEAP_HPP_

template<typename T>
class Heap {
 private:
  T *arr;
  int count;
  int capacity;

  void shiftUp(T n) {
    arr[++count] = n;

    int k = count;
    while (k > 1 && arr[k / 2] < arr[k]) {
      swap(arr[k / 2], arr[k]);
      k /= 2;
    }
  }

  void shiftDown(T n) {
    while (n * 2 <= count) {
      int j = n * 2;
      if (j + 1 <= count && arr[j + 1] > arr[j]) {
        ++j;
      }
      if (arr[n] < arr[j])
        swap(arr[n], arr[j])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ;
      n = j;
    }
  }

 public:
  Heap(int n) {
    arr = new T[n + 1];
    int capacity = n;
    count = 0;
  }

  Heap(T arr_in[], int n) {
    arr = new T[n + 1];
    count = n;
    copy(arr_in, arr_in + n, arr + 1);
    for (int i = n / 2; i >= 1; i--) {
      shiftDown(i);
      printHeap();
    }
  }

  ~Heap() {
    delete[]arr;
  }

  void insert(T n) {
    assert(count + 1 <= capacity);
    shiftUp(n);
  }

  int extract(void) {
    assert(count >= 1);
    int ret = arr[1];
    arr[1] = arr[count--];
    if (count > 1)
      shiftDown(1);

    return ret;
  }

  void printHeap() {
    int flag = 1;
    int max = 1;
    while (max < count) max <<= 1;
    max <<= 1;
    cout << "The structure of Heap:";
    for (int i = 1; i <= count; ++i) {
      if (i == flag) {
        cout << endl;
        flag <<= 1;
        max /= 2;
        for (int k = 0; k < max / 2; ++k)
          cout << "  ";
      }
      cout << setw(2) << arr[i];
      for (int k = 0; k < max - 1; ++k)
        cout << "  ";
    }
    cout << endl;
  }

};

/*
  Heap<int> test = Heap<int>(50);
  srand(time(NULL));
  for (int i = 0; i < 50; i++) {
    test.insert(rand() % 90 + 10);
  }

  test.printHeap();
  cout << endl << "After Heap sort Array:" << endl;
  for (int i = 0; i < 50; i++)
    cout << test.extract() << " ";
  cout << endl;
 */

#endif //INC_1_SORT__HEAP_HPP_
